<!DOCTYPE html>
<html lang="CH">
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
<title>Jetpack之自定义Navigation - 小草喔</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



    <meta name="description" content="Jetpack之自定义Navigation">
<meta name="keywords" content="jetpack">
<meta property="og:type" content="article">
<meta property="og:title" content="Jetpack之自定义Navigation">
<meta property="og:url" content="https://chsmy.github.io/2020/04/19/technology/Jetpack之自定义Navigation/index.html">
<meta property="og:site_name" content="小草喔">
<meta property="og:description" content="Jetpack之自定义Navigation">
<meta property="og:locale" content="CHS">
<meta property="og:updated_time" content="2020-04-19T07:45:59.374Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Jetpack之自定义Navigation">
<meta name="twitter:description" content="Jetpack之自定义Navigation">





<link rel="icon" href="/images/favicon.svg">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/darcula.css">


    
    
    
    <style>body>.footer,body>.navbar,body>.section{opacity:0}</style>
    

    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">
    

    
    

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">


    
    
    
    

<link rel="stylesheet" href="/css/back-to-top.css">


    
    
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-72437521-5"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-72437521-5');
</script>


    
    
    
    
<script>
    (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:1067642,hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
</script>


    
    
<link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>

    
    
    

    
    
    


<link rel="stylesheet" href="/css/style.css">
</head>
<body class="is-3-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/logo.png" alt="Jetpack之自定义Navigation" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item" href="/">首页</a>
                
                <a class="navbar-item" href="/archives">归档</a>
                
                <a class="navbar-item" href="/categories">分类</a>
                
                <a class="navbar-item" href="/tags">标签</a>
                
                <a class="navbar-item" href="/about">关于</a>
                
            </div>
            
            <div class="navbar-end">
                
                    
                    
                    <a class="navbar-item" target="_blank" title="Download on GitHub" href="https://github.com/chsmy">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                    
                
                
                
                <a class="navbar-item search" title="Pencarian" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-6-widescreen has-order-2 column-main"><div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-04-19T07:43:37.000Z">2020-04-19</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Android/">Android</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/Android/jetpack/">jetpack</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    33 minutes membaca (Sekitar 4905 kata)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                Jetpack之自定义Navigation
            
        </h1>
        <div class="content">
            <p>Jetpack之自定义Navigation</p>
<a id="more"></a>
<p>之前的一篇文章<a href="https://juejin.im/post/5e4e91476fb9a07c8678f627" target="_blank" rel="noopener">Android Jetpack之Navigation</a>对Navigation的使用进行了练习，并且看了一下Navigation的源码。虽然Navigation的功能很强大，不过在xml中配置感觉还是不够灵活，随着项目的增大，页面多了之后xml会变的非常庞大不利于维护。而且使用Navigation做底部导航的时候，每次都会新建Fragment，这个也不是我们想要的，因此来改造一下Navigation</p>
<h3 id="底部导航"><a href="#底部导航" class="headerlink" title="底部导航"></a>底部导航</h3><p>通过上一篇中查看源代码我们知道，在xml中配置的navigation，最终会被解析成一个一个的Destination对象然后放到一个导航图NavGraph中。然后通过NavController交给ActivityNavigator、FragmentNavigator等去执行导航。</p>
<p>改造自后的Navigation，不用在xml中配置，只需在页面上添加相关的注解就可以了，然后通过注解拿到页面信息自己组建导航图，本部分主体路参考了<a href="https://coding.imooc.com/learn/list/402.html" target="_blank" rel="noopener">慕课网短视频实战项目</a></p>
<p>先看一下改造之后的用法，4个Fragment和底部导航栏<br><figure class="highlight kotlin hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@FragmentDestination(pageUrl = WanRouterKey.FRAGMENT_MAIN_TABLES_HOME, asStarter = true)</span></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HomeFragment</span> : <span class="hljs-type">BaseFragment</span></span>()&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-meta">@FragmentDestination(pageUrl = WanRouterKey.FRAGMENT_MAIN_TABLES_APPLY)</span></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApplyFragment</span> : <span class="hljs-type">BaseFragment</span></span>() &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-meta">@FragmentDestination(pageUrl = WanRouterKey.FRAGMENT_MAIN_TABLES_FIND)</span></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FindFragment</span> : <span class="hljs-type">BaseFragment</span></span>() &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-meta">@FragmentDestination(pageUrl = WanRouterKey.FRAGMENT_MAIN_TABLES_MINE)</span></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MineFragment</span> : <span class="hljs-type">BaseFragment</span></span>() &#123;&#125;</span><br></pre></td></tr></table></figure></p>
<p>四个Fragment分别添加FragmentDestination注解，pageUrl是导航路径为常量。HomeFragment注解中的asStarter 参数代表是启动的第一个页面</p>
<p>MainActivity的xml中，继承系统BottomNavigationView自定义底部底部图标和文字，省去在res/menu文件夹下的xml配置<br><figure class="highlight xml hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-tag">&lt;<span class="hljs-name">androidx.constraintlayout.widget.ConstraintLayout</span></span></span><br><span class="line"><span class="hljs-tag">        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"match_parent"</span></span></span><br><span class="line"><span class="hljs-tag">        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"match_parent"</span>&gt;</span></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">com.chs.lib_core.navigation.BottomBarView</span></span></span><br><span class="line"><span class="hljs-tag">            <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/nav_view"</span></span></span><br><span class="line"><span class="hljs-tag">            <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"0dp"</span></span></span><br><span class="line"><span class="hljs-tag">            <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span></span></span><br><span class="line"><span class="hljs-tag">            <span class="hljs-attr">android:layout_marginStart</span>=<span class="hljs-string">"0dp"</span></span></span><br><span class="line"><span class="hljs-tag">            <span class="hljs-attr">android:layout_marginEnd</span>=<span class="hljs-string">"0dp"</span></span></span><br><span class="line"><span class="hljs-tag">            <span class="hljs-attr">android:background</span>=<span class="hljs-string">"?android:attr/windowBackground"</span></span></span><br><span class="line"><span class="hljs-tag">            <span class="hljs-attr">app:layout_constraintBottom_toBottomOf</span>=<span class="hljs-string">"parent"</span></span></span><br><span class="line"><span class="hljs-tag">            <span class="hljs-attr">app:layout_constraintLeft_toLeftOf</span>=<span class="hljs-string">"parent"</span></span></span><br><span class="line"><span class="hljs-tag">            <span class="hljs-attr">app:layout_constraintRight_toRightOf</span>=<span class="hljs-string">"parent"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="hljs-tag">&lt;<span class="hljs-name">fragment</span></span></span><br><span class="line"><span class="hljs-tag">            <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/nav_host_fragment"</span></span></span><br><span class="line"><span class="hljs-tag">            <span class="hljs-attr">android:name</span>=<span class="hljs-string">"androidx.navigation.fragment.NavHostFragment"</span></span></span><br><span class="line"><span class="hljs-tag">            <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"match_parent"</span></span></span><br><span class="line"><span class="hljs-tag">            <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"match_parent"</span></span></span><br><span class="line"><span class="hljs-tag">            <span class="hljs-attr">app:defaultNavHost</span>=<span class="hljs-string">"true"</span></span></span><br><span class="line"><span class="hljs-tag">            <span class="hljs-attr">app:layout_constraintBottom_toTopOf</span>=<span class="hljs-string">"@id/nav_view"</span></span></span><br><span class="line"><span class="hljs-tag">            <span class="hljs-attr">app:layout_constraintLeft_toLeftOf</span>=<span class="hljs-string">"parent"</span></span></span><br><span class="line"><span class="hljs-tag">            <span class="hljs-attr">app:layout_constraintRight_toRightOf</span>=<span class="hljs-string">"parent"</span></span></span><br><span class="line"><span class="hljs-tag">            <span class="hljs-attr">app:layout_constraintTop_toTopOf</span>=<span class="hljs-string">"parent"</span> /&gt;</span></span><br><span class="line"><span class="hljs-tag">&lt;/<span class="hljs-name">androidx.constraintlayout.widget.ConstraintLayout</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>MainActivity的onCreate中<br><figure class="highlight kotlin hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">val</span> navController = Navigation.findNavController(<span class="hljs-keyword">this</span>, R.id.nav_host_fragment)</span><br><span class="line">NavGraphBuilder.build(navController,<span class="hljs-keyword">this</span>,R.id.nav_host_fragment)</span><br><span class="line">nav_view.setNavController(navController)</span><br></pre></td></tr></table></figure></p>
<p>到此一个底部导航就完成了，不用向原生Navigation一样在res/navitaion和res/menu文件夹中使用想xml文件配置了，是不是简单了灵活许多。</p>
<p>如何实现上面功能呢</p>
<ol>
<li>原生的Navigation需要在res/navigation文件夹下创建xml文件来配置所有需要导航的页面结点，这些结点上都有需要导航的页面的全类名，程序运行的时候，会解析该xml文件，拿到全类名，组装导航图，然后交给然后交给ActivityNavigator、FragmentNavigator等类去实现跳转。我们通过注解处理器在编译的时候可以拿到所有自定义的注解标注过的类的全类名，然后保存到一个json文件中，放到asssets目录下，程序运行的时候解析文件，自己组装导航图</li>
<li>原生的BottomNavigationView也是一样，需要在res/menu文件夹下创建xml文件来配置底部按钮的文字和icon,我们也可以将底部按钮的信息保存到一个json文件中，然后自定义一个BottomBarView继承BottomNavigationView然后自己解析并组装底部栏</li>
</ol>
<p>OK 思路有啦开始干，首先创建两个java Module：lib_annotation 和 lib_compiler 用来编写注解类和注解处理器</p>
<h4 id="编写注解处理器"><a href="#编写注解处理器" class="headerlink" title="编写注解处理器"></a>编写注解处理器</h4><p><strong>lib_annotation</strong> ：中编写ActivityDestination和FragmentDestination分别用来标记activity和fragment<br><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@Target</span>(ElementType.TYPE)</span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> ActivityDestination &#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 页面路径</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-function">String <span class="hljs-title">pageUrl</span><span class="hljs-params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     *</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 是否需要登录</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">needLogin</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">false</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 是否是启动页</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">asStarter</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">false</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 是否属于主页中的tab页面  首页tab有可能点击去一个新的activity</span></span><br><span class="line"><span class="hljs-comment">     */</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">isBelongTab</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">false</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@Target(ElementType.TYPE)</span><br><span class="line">public @interface FragmentDestination &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * @return 页面路径</span><br><span class="line">     */</span><br><span class="line">    String pageUrl();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *</span><br><span class="line">     * @return 是否需要登录</span><br><span class="line">     */</span><br><span class="line">    boolean needLogin() default false;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * @return 是否是启动页</span><br><span class="line">     */</span><br><span class="line">    boolean asStarter() default false;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>lib_compiler</strong> 中编写注解处理器，来解析带有注解的类</p>
<p>首先在build.gradle中添加相关依赖<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    implementation fileTree(dir: &apos;libs&apos;, include: [&apos;*.jar&apos;])</span><br><span class="line">    implementation project(&apos;:lib_annotation&apos;)</span><br><span class="line">    implementation &apos;com.alibaba:fastjson:1.2.59&apos;</span><br><span class="line">    compileOnly &apos;com.google.auto.service:auto-service:1.0-rc6&apos;</span><br><span class="line">    annotationProcessor &apos;com.google.auto.service:auto-service:1.0-rc6&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>lib_annotation是前面定义的注解module，fastjson用来生成json对象，auto-service用来编译时自动执行注解处理器</p>
<p>注解处理器NavProcessor<br><figure class="highlight java hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@AutoService</span>(Processor.class)</span><br><span class="line"><span class="hljs-meta">@SupportedSourceVersion</span>(SourceVersion.RELEASE_8)</span><br><span class="line"><span class="hljs-meta">@SupportedAnnotationTypes</span>(&#123;<span class="hljs-string">"com.chs.lib_annotation.ActivityDestination"</span>,<span class="hljs-string">"com.chs.lib_annotation.FragmentDestination"</span>&#125;)</span><br><span class="line"><span class="hljs-meta">@SupportedOptions</span>(<span class="hljs-string">"moduleName"</span>)</span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NavProcessor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AbstractProcessor</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">private</span> Messager messager;</span><br><span class="line">    <span class="hljs-keyword">private</span> Filer filer;</span><br><span class="line">    <span class="hljs-keyword">private</span> String outFileName;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">(ProcessingEnvironment processingEnv)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-keyword">super</span>.init(processingEnv);</span><br><span class="line">        <span class="hljs-comment">//日志工具</span></span><br><span class="line">        messager = processingEnv.getMessager();</span><br><span class="line">        <span class="hljs-comment">//文件处理工具</span></span><br><span class="line">        filer = processingEnv.getFiler();</span><br><span class="line">        <span class="hljs-comment">//获取gradle中配置的内容作为生成文件的名字</span></span><br><span class="line">        outFileName = processingEnv.getOptions().get(<span class="hljs-string">"moduleName"</span>) + <span class="hljs-string">"_nav.json"</span>;</span><br><span class="line">        messager.printMessage(Diagnostic.Kind.NOTE,<span class="hljs-string">"moduleName:"</span>+outFileName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@Override</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">process</span><span class="hljs-params">(Set&lt;? extends TypeElement&gt; annotations, RoundEnvironment roundEnv)</span> </span>&#123;</span><br><span class="line">        <span class="hljs-comment">//拿到带有这两个注解的类的集合</span></span><br><span class="line">        Set&lt;? extends Element&gt; fragmentElement = roundEnv.getElementsAnnotatedWith(FragmentDestination.class);</span><br><span class="line">        Set&lt;? extends Element&gt; activityElement = roundEnv.getElementsAnnotatedWith(ActivityDestination.class);</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">if</span>(!fragmentElement.isEmpty()||!activityElement.isEmpty())&#123;</span><br><span class="line">            Map&lt;String, JSONObject&gt; destMap = <span class="hljs-keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">            handleDestination(fragmentElement,FragmentDestination.class,destMap);</span><br><span class="line">            handleDestination(activityElement,ActivityDestination.class,destMap);</span><br><span class="line">            FileOutputStream fos = <span class="hljs-keyword">null</span>;</span><br><span class="line">            OutputStreamWriter writer = <span class="hljs-keyword">null</span>;</span><br><span class="line">            <span class="hljs-comment">//将map转换为json文件，保存到app/src/asset中</span></span><br><span class="line">            <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">                <span class="hljs-comment">//filer.createResource方法用来生成源文件</span></span><br><span class="line">                <span class="hljs-comment">//StandardLocation.CLASS_OUTPUT java文件生成class文件的位置，/build/intermediates/javac/debug/classes/目录下</span></span><br><span class="line">                FileObject resource = filer.createResource(StandardLocation.CLASS_OUTPUT, <span class="hljs-string">""</span>, outFileName);</span><br><span class="line">                String resourcePath = resource.toUri().getPath();</span><br><span class="line">                messager.printMessage(Diagnostic.Kind.NOTE,<span class="hljs-string">"resourcePath:"</span>+resourcePath);</span><br><span class="line"></span><br><span class="line">                String appPath = resourcePath.substring(<span class="hljs-number">0</span>,resourcePath.indexOf(<span class="hljs-string">"build"</span>));</span><br><span class="line">                String assetPath = appPath + <span class="hljs-string">"src/main/assets"</span>;</span><br><span class="line"></span><br><span class="line">                File assetDir = <span class="hljs-keyword">new</span> File(assetPath);</span><br><span class="line">                <span class="hljs-keyword">if</span>(!assetDir.exists())&#123;</span><br><span class="line">                    assetDir.mkdir();</span><br><span class="line">                &#125;</span><br><span class="line">                File assetFile = <span class="hljs-keyword">new</span> File(assetDir,outFileName);</span><br><span class="line">                <span class="hljs-keyword">if</span>(assetFile.exists())&#123;</span><br><span class="line">                    assetFile.delete();</span><br><span class="line">                &#125;</span><br><span class="line">                assetFile.createNewFile();</span><br><span class="line">                String content = JSON.toJSONString(destMap);</span><br><span class="line"></span><br><span class="line">                fos = <span class="hljs-keyword">new</span> FileOutputStream(assetFile);</span><br><span class="line">                writer = <span class="hljs-keyword">new</span> OutputStreamWriter(fos, StandardCharsets.UTF_8);</span><br><span class="line">                writer.write(content);</span><br><span class="line">                writer.flush();</span><br><span class="line">            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;<span class="hljs-keyword">finally</span> &#123;</span><br><span class="line">                <span class="hljs-keyword">if</span>(fos!=<span class="hljs-keyword">null</span>)&#123;</span><br><span class="line">                    <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">                        fos.close();</span><br><span class="line">                    &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="hljs-keyword">if</span>(writer!=<span class="hljs-keyword">null</span>)&#123;</span><br><span class="line">                    <span class="hljs-keyword">try</span> &#123;</span><br><span class="line">                        writer.close();</span><br><span class="line">                    &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">handleDestination</span><span class="hljs-params">(Set&lt;? extends Element&gt; elements, Class&lt;? extends Annotation&gt; desAnnotationClazz,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">                                   Map&lt;String, JSONObject&gt; destMap)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">for</span> (Element element : elements) &#123;</span><br><span class="line">            <span class="hljs-comment">//TypeElement代表类或者接口，因为定义的注解是写在类上面的，所以可以直接转换成TypeElement</span></span><br><span class="line">            TypeElement typeElement = (TypeElement) element;</span><br><span class="line">            <span class="hljs-comment">//获取全类名</span></span><br><span class="line">            String className = typeElement.getQualifiedName().toString();</span><br><span class="line">            <span class="hljs-keyword">int</span> id = Math.abs(className.hashCode());</span><br><span class="line">            String pageUrl = <span class="hljs-keyword">null</span>;</span><br><span class="line">            <span class="hljs-keyword">boolean</span> needLogin = <span class="hljs-keyword">false</span>;</span><br><span class="line">            <span class="hljs-keyword">boolean</span> asStarter = <span class="hljs-keyword">false</span>;</span><br><span class="line">            <span class="hljs-keyword">boolean</span> isFragment = <span class="hljs-keyword">true</span>;</span><br><span class="line">            <span class="hljs-keyword">boolean</span> isBelongTab = <span class="hljs-keyword">false</span>;</span><br><span class="line"><span class="hljs-comment">//            messager.printMessage(Diagnostic.Kind.NOTE,"className:"+className);</span></span><br><span class="line">            Annotation annotation = element.getAnnotation(desAnnotationClazz);</span><br><span class="line">            <span class="hljs-comment">//根据不同的注解获取注解的参数</span></span><br><span class="line">            <span class="hljs-keyword">if</span>(annotation <span class="hljs-keyword">instanceof</span> FragmentDestination)&#123;</span><br><span class="line">                FragmentDestination destination =  (FragmentDestination) annotation;</span><br><span class="line">                pageUrl = destination.pageUrl();</span><br><span class="line">                needLogin = destination.needLogin();</span><br><span class="line">                asStarter = destination.asStarter();</span><br><span class="line">                isFragment = <span class="hljs-keyword">true</span>;</span><br><span class="line">            &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(annotation <span class="hljs-keyword">instanceof</span> ActivityDestination)&#123;</span><br><span class="line">                ActivityDestination destination =  (ActivityDestination) annotation;</span><br><span class="line">                pageUrl = destination.pageUrl();</span><br><span class="line">                needLogin = destination.needLogin();</span><br><span class="line">                asStarter = destination.asStarter();</span><br><span class="line">                isFragment = <span class="hljs-keyword">false</span>;</span><br><span class="line">                isBelongTab = destination.isBelongTab();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-comment">//将参数封装成JsonObject后放到map中保存</span></span><br><span class="line">            <span class="hljs-keyword">if</span>(destMap.containsKey(pageUrl))&#123;</span><br><span class="line">               messager.printMessage(Diagnostic.Kind.ERROR,<span class="hljs-string">"不允许使用相同的pagUrl:"</span>+className);</span><br><span class="line">            &#125;<span class="hljs-keyword">else</span> &#123;</span><br><span class="line">                JSONObject jsonObject = <span class="hljs-keyword">new</span> JSONObject();</span><br><span class="line">                jsonObject.put(<span class="hljs-string">"id"</span>,id);</span><br><span class="line">                jsonObject.put(<span class="hljs-string">"className"</span>,className);</span><br><span class="line">                jsonObject.put(<span class="hljs-string">"pageUrl"</span>,pageUrl);</span><br><span class="line">                jsonObject.put(<span class="hljs-string">"needLogin"</span>,needLogin);</span><br><span class="line">                jsonObject.put(<span class="hljs-string">"asStarter"</span>,asStarter);</span><br><span class="line">                jsonObject.put(<span class="hljs-string">"isFragment"</span>,isFragment);</span><br><span class="line">                jsonObject.put(<span class="hljs-string">"isBelongTab"</span>,isBelongTab);</span><br><span class="line">                destMap.put(pageUrl,jsonObject);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ol>
<li>注解处理器的目标是，扫描出所有带FragmentDestination或者ActivityDestination的类，拿到注解中的参数和类的全类名，封装成对象放到map中，使用fastjson将map生成json字符串，保存在src/main/assets目录下面</li>
<li>在组件化开发的时候，每个module中都会生成一个src/main/assets目录和一个json文件，APP打包的时候，如果文件名字相同，只会使用app module下的json文件，子module的都会遗弃。所以需要在不同module下生成不同名字的json文件来保证所有添加自定义注解的类都能收集到。文件的名字使用的时候可以在使用该注解处理器的module的gradle中通过javaCompileOptions参数配置，配置完成就可以在注解处理器init方法中拿到该名字，然后给json文件命名</li>
</ol>
<p>注解和注解处理器写完了，现在去项目中使用以下</p>
<p>首先在build.gradle中android闭包下面添加如下代码来配置生成json的名字前缀</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">javaCompileOptions &#123;</span><br><span class="line">           annotationProcessorOptions &#123;</span><br><span class="line">               arguments = [moduleName: project.getName()]</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>
<p>然后引入注解和注解处理器，主项目是kotlin项目，所以使用kapt引入，java项目使用annotationProcessor引入<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">implementation project(path: &apos;:lib_annotation&apos;)</span><br><span class="line">kapt project(path: &apos;:lib_compiler&apos;)</span><br></pre></td></tr></table></figure></p>
<p>然后rebuild项目，可以看到app/src/main/assets目录下面生成了app_nav.json文件，打开文件可以看到<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;main/tabs/MineFragment&quot;: &#123;</span><br><span class="line">    &quot;isFragment&quot;: true,</span><br><span class="line">    &quot;isBelongTab&quot;: false,</span><br><span class="line">    &quot;asStarter&quot;: false,</span><br><span class="line">    &quot;needLogin&quot;: false,</span><br><span class="line">    &quot;className&quot;: &quot;com.chs.bigsea.ui.mine.MineFragment&quot;,</span><br><span class="line">    &quot;pageUrl&quot;: &quot;main/tabs/MineFragment&quot;,</span><br><span class="line">    &quot;id&quot;: 1818876842</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;main/tabs/FindFragment&quot;: &#123;</span><br><span class="line">    &quot;isFragment&quot;: true,</span><br><span class="line">    &quot;isBelongTab&quot;: false,</span><br><span class="line">    &quot;asStarter&quot;: false,</span><br><span class="line">    &quot;needLogin&quot;: false,</span><br><span class="line">    &quot;className&quot;: &quot;com.chs.bigsea.ui.find.FindFragment&quot;,</span><br><span class="line">    &quot;pageUrl&quot;: &quot;main/tabs/FindFragment&quot;,</span><br><span class="line">    &quot;id&quot;: 1292676074</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;main/tabs/ApplyFragment&quot;: &#123;</span><br><span class="line">    &quot;isFragment&quot;: true,</span><br><span class="line">    &quot;isBelongTab&quot;: false,</span><br><span class="line">    &quot;asStarter&quot;: false,</span><br><span class="line">    &quot;needLogin&quot;: false,</span><br><span class="line">    &quot;className&quot;: &quot;com.chs.bigsea.ui.apply.ApplyFragment&quot;,</span><br><span class="line">    &quot;pageUrl&quot;: &quot;main/tabs/ApplyFragment&quot;,</span><br><span class="line">    &quot;id&quot;: 1185318390</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>HomeFragment因为在另一module，所以生成的文件也在另一个module中了</p>
<h4 id="构建导航图"><a href="#构建导航图" class="headerlink" title="构建导航图"></a>构建导航图</h4><p>json文件生成完成，下一步就是来构建导航图了，新建一个NavGraphBuilder类来构建<br><figure class="highlight kotlin hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">build</span><span class="hljs-params">(navController: <span class="hljs-type">NavController</span>, activity: <span class="hljs-type">FragmentActivity</span>, containerId: <span class="hljs-type">Int</span>)</span></span> &#123;</span><br><span class="line">            <span class="hljs-keyword">val</span> navigatorProvider = navController.navigatorProvider</span><br><span class="line">            <span class="hljs-keyword">val</span> fragmentNavigator = CustomFragmentNavigator(</span><br><span class="line">                activity, activity.supportFragmentManager,</span><br><span class="line">                containerId</span><br><span class="line">            )</span><br><span class="line">            navigatorProvider.addNavigator(fragmentNavigator)</span><br><span class="line">            <span class="hljs-keyword">val</span> activityNavigator = navigatorProvider.getNavigator(ActivityNavigator::<span class="hljs-class"><span class="hljs-keyword">class</span>.<span class="hljs-title">java</span>)</span></span><br><span class="line"></span><br><span class="line">            <span class="hljs-keyword">val</span> destinationMap = NavConfig.getDestinationMap()</span><br><span class="line">            <span class="hljs-keyword">val</span> navGraph = NavGraph(NavGraphNavigator(navigatorProvider))</span><br><span class="line"></span><br><span class="line">            <span class="hljs-keyword">for</span> ((key, destination) <span class="hljs-keyword">in</span> destinationMap) &#123;</span><br><span class="line">                <span class="hljs-keyword">if</span> (destination.isFragment) &#123;</span><br><span class="line">                    <span class="hljs-keyword">val</span> fragmentDestination = fragmentNavigator.createDestination()</span><br><span class="line">                    fragmentDestination.className = destination.className!!</span><br><span class="line">                    fragmentDestination.id = destination.id</span><br><span class="line">                    fragmentDestination.addDeepLink(destination.pageUrl!!)</span><br><span class="line">                    navGraph.addDestination(fragmentDestination)</span><br><span class="line">                &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">                    <span class="hljs-keyword">if</span>(destination.isBelongTab)&#123;</span><br><span class="line">                        <span class="hljs-keyword">val</span> activityDestination = activityNavigator.createDestination()</span><br><span class="line">                        activityDestination.id = destination.id</span><br><span class="line">                        activityDestination.setComponentName(</span><br><span class="line">                            ComponentName(</span><br><span class="line">                                Utils.getApp().packageName,</span><br><span class="line">                                destination.className!!</span><br><span class="line">                            )</span><br><span class="line">                        )</span><br><span class="line">                        activityDestination.addDeepLink(destination.pageUrl!!)</span><br><span class="line">                        navGraph.addDestination(activityDestination)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="hljs-keyword">if</span> (destination.asStarter) &#123;</span><br><span class="line">                    navGraph.startDestination = destination.id</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            navController.graph = navGraph</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure></p>
<p>构建导航图有三个比较大的部分</p>
<ol>
<li>将json文件解析为map</li>
<li>遍历map，判断是fragment还是activity，根据不同 类型分别创建不同的Destination对象，并将这些Destination对象add到导航图中，给导航图设置起始页面，最后把导航图设置给主页穿过来的NavController对象</li>
<li>上一篇文章<a href="https://juejin.im/post/5e4e91476fb9a07c8678f627" target="_blank" rel="noopener">Android Jetpack之Navigation</a>中，我们知道，FragmentNavigator类在导航Fragment页面的时候，使用的是FragmentTransaction的replace方法，而replace方法每次都会重新创建Fragment对象，而对于首页导航，我们不希望每次都重建，重新走生命周期方法，所以这里需要自定义一个FragmentNavigator，将其内部的replace该给hide和show</li>
</ol>
<p><strong>解析json文件：</strong></p>
<figure class="highlight kotlin hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NavConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> &#123;</span><br><span class="line">        <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> sDestinationMap: HashMap&lt;String, Destination&gt; = HashMap()</span><br><span class="line">        <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> sBottomBar: BottomBar? = <span class="hljs-literal">null</span></span><br><span class="line"></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getDestinationMap</span><span class="hljs-params">()</span></span>: HashMap&lt;String, Destination&gt; &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (sDestinationMap.size == <span class="hljs-number">0</span>) &#123;</span><br><span class="line">                <span class="hljs-keyword">val</span> jsons = parseNavFile()</span><br><span class="line">                <span class="hljs-keyword">for</span> (json <span class="hljs-keyword">in</span> jsons)&#123;</span><br><span class="line">                    <span class="hljs-keyword">val</span> destination: HashMap&lt;String, Destination&gt; = GsonUtils.fromJson(json,</span><br><span class="line">                        <span class="hljs-keyword">object</span> : TypeToken&lt;HashMap&lt;String, Destination&gt;&gt;()&#123;&#125;.type)</span><br><span class="line">                    sDestinationMap.putAll(destination)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">return</span> sDestinationMap</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getBottomBar</span><span class="hljs-params">()</span></span>: BottomBar &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (sBottomBar == <span class="hljs-literal">null</span>) &#123;</span><br><span class="line">                <span class="hljs-keyword">val</span> jsonContent = parseFile(<span class="hljs-string">"main_tabs_config.json"</span>)</span><br><span class="line">                sBottomBar = GsonUtils.fromJson(jsonContent, BottomBar::<span class="hljs-class"><span class="hljs-keyword">class</span>.<span class="hljs-title">java</span>)</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">return</span> sBottomBar!!</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">         * 解析assets中特定文件</span></span><br><span class="line"><span class="hljs-comment">         */</span></span><br><span class="line">        <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">parseFile</span><span class="hljs-params">(s: <span class="hljs-type">String</span>)</span></span>: String &#123;</span><br><span class="line">            <span class="hljs-keyword">val</span> assets = Utils.getApp().resources.assets</span><br><span class="line">            <span class="hljs-keyword">val</span> <span class="hljs-keyword">open</span> = assets.<span class="hljs-keyword">open</span>(s)</span><br><span class="line">            <span class="hljs-keyword">val</span> stringBuilder = StringBuilder()</span><br><span class="line">            <span class="hljs-keyword">val</span> bufferedReader = BufferedReader(InputStreamReader(<span class="hljs-keyword">open</span>))</span><br><span class="line">            bufferedReader.use &#123;</span><br><span class="line">                <span class="hljs-keyword">var</span> line: String?</span><br><span class="line">                <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;</span><br><span class="line">                    line = it.readLine() ?: <span class="hljs-keyword">break</span></span><br><span class="line">                    stringBuilder.append(line)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">return</span> stringBuilder.toString()</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment">/**</span></span><br><span class="line"><span class="hljs-comment">         * 解析assets下的所有的导航相关的文件</span></span><br><span class="line"><span class="hljs-comment">         */</span></span><br><span class="line">        <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">parseNavFile</span><span class="hljs-params">()</span></span>:List&lt;String&gt;&#123;</span><br><span class="line">            <span class="hljs-keyword">val</span> jsons = mutableListOf&lt;String&gt;()</span><br><span class="line">            <span class="hljs-keyword">val</span> assets = Utils.getApp().resources.assets</span><br><span class="line">            <span class="hljs-keyword">val</span> list = assets.list(<span class="hljs-string">""</span>);</span><br><span class="line">            <span class="hljs-keyword">if</span> (list != <span class="hljs-literal">null</span>) &#123;</span><br><span class="line">                <span class="hljs-keyword">for</span> (item <span class="hljs-keyword">in</span> list)&#123;</span><br><span class="line">                    <span class="hljs-keyword">if</span>(item.contains(<span class="hljs-string">"_nav"</span>))&#123;</span><br><span class="line">                        jsons.add(parseFile(item))</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">return</span> jsons</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>解析主要就是流的读取，遍历asssets目录下是文件，找到导航相关的json文件，解析成对象放到一个map中保存，供创建导航图的时候使用。</p>
<p><strong>自定义FragmentNavigator：</strong><br><figure class="highlight kotlin hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@Navigator</span>.Name(<span class="hljs-string">"customfragment"</span>)</span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomFragmentNavigator</span></span>(context: Context, manager: FragmentManager, containerId: <span class="hljs-built_in">Int</span>) :</span><br><span class="line">    Navigator&lt;FragmentNavigator.Destination&gt;() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> TAG = <span class="hljs-string">"CustomFragmentNavigator"</span></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> KEY_BACK_STACK_IDS = <span class="hljs-string">"androidx-nav-fragment:navigator:backStackIds"</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> mContext: Context = context</span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> mFragmentManager: FragmentManager = manager</span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> mContainerId = containerId</span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> mBackStack = ArrayDeque&lt;<span class="hljs-built_in">Int</span>&gt;()</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">navigate</span><span class="hljs-params">(</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        destination: <span class="hljs-type">FragmentNavigator</span>.<span class="hljs-type">Destination</span>,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        args: <span class="hljs-type">Bundle</span>?,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        navOptions: <span class="hljs-type">NavOptions</span>?,</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">        navigatorExtras: <span class="hljs-type">Extras</span>?</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-params">    )</span></span>: NavDestination? &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (mFragmentManager!!.isStateSaved) &#123;</span><br><span class="line">            Log.i(</span><br><span class="line">                TAG,</span><br><span class="line">                <span class="hljs-string">"Ignoring navigate() call: FragmentManager has already"</span></span><br><span class="line">                        + <span class="hljs-string">" saved its state"</span></span><br><span class="line">            )</span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">var</span> className = destination.className</span><br><span class="line">        <span class="hljs-keyword">if</span> (className[<span class="hljs-number">0</span>] == <span class="hljs-string">'.'</span>) &#123;</span><br><span class="line">            className = mContext!!.packageName + className</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">val</span> ft = mFragmentManager!!.beginTransaction()</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">var</span> enterAnim = navOptions?.enterAnim ?: -<span class="hljs-number">1</span></span><br><span class="line">        <span class="hljs-keyword">var</span> exitAnim = navOptions?.exitAnim ?: -<span class="hljs-number">1</span></span><br><span class="line">        <span class="hljs-keyword">var</span> popEnterAnim = navOptions?.popEnterAnim ?: -<span class="hljs-number">1</span></span><br><span class="line">        <span class="hljs-keyword">var</span> popExitAnim = navOptions?.popExitAnim ?: -<span class="hljs-number">1</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (enterAnim != -<span class="hljs-number">1</span> || exitAnim != -<span class="hljs-number">1</span> || popEnterAnim != -<span class="hljs-number">1</span> || popExitAnim != -<span class="hljs-number">1</span>) &#123;</span><br><span class="line">            enterAnim = <span class="hljs-keyword">if</span> (enterAnim != -<span class="hljs-number">1</span>) enterAnim <span class="hljs-keyword">else</span> <span class="hljs-number">0</span></span><br><span class="line">            exitAnim = <span class="hljs-keyword">if</span> (exitAnim != -<span class="hljs-number">1</span>) exitAnim <span class="hljs-keyword">else</span> <span class="hljs-number">0</span></span><br><span class="line">            popEnterAnim = <span class="hljs-keyword">if</span> (popEnterAnim != -<span class="hljs-number">1</span>) popEnterAnim <span class="hljs-keyword">else</span> <span class="hljs-number">0</span></span><br><span class="line">            popExitAnim = <span class="hljs-keyword">if</span> (popExitAnim != -<span class="hljs-number">1</span>) popExitAnim <span class="hljs-keyword">else</span> <span class="hljs-number">0</span></span><br><span class="line">            ft.setCustomAnimations(enterAnim, exitAnim, popEnterAnim, popExitAnim)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">val</span> frg = mFragmentManager!!.primaryNavigationFragment</span><br><span class="line">        <span class="hljs-keyword">if</span> (frg != <span class="hljs-literal">null</span>) &#123;</span><br><span class="line">            ft.hide(frg)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">val</span> tag = destination.id.toString()</span><br><span class="line">        <span class="hljs-keyword">var</span> fragment = mFragmentManager!!.findFragmentByTag(tag)</span><br><span class="line">        <span class="hljs-keyword">if</span> (fragment == <span class="hljs-literal">null</span>) &#123;</span><br><span class="line">            fragment = mFragmentManager.getFragmentFactory().instantiate(mContext.classLoader, className)</span><br><span class="line">            fragment!!.arguments = args</span><br><span class="line">            ft.add(mContainerId, fragment, tag)</span><br><span class="line">        &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">            ft.show(fragment)</span><br><span class="line">        &#125;</span><br><span class="line">        ft.setPrimaryNavigationFragment(fragment)</span><br><span class="line"></span><br><span class="line">        <span class="hljs-meta">@IdRes</span> <span class="hljs-keyword">val</span> destId = destination.id</span><br><span class="line">        <span class="hljs-keyword">val</span> initialNavigation = mBackStack.isEmpty()</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">var</span> np = navOptions</span><br><span class="line">        np = NavOptions.Builder().setLaunchSingleTop(<span class="hljs-literal">true</span>).build()</span><br><span class="line">        <span class="hljs-keyword">val</span> isSingleTopReplacement = (!initialNavigation</span><br><span class="line">                &amp;&amp; np.shouldLaunchSingleTop())</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">val</span> isAdded: <span class="hljs-built_in">Boolean</span></span><br><span class="line">        isAdded = <span class="hljs-keyword">if</span> (initialNavigation) &#123;</span><br><span class="line">            <span class="hljs-literal">true</span></span><br><span class="line">        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isSingleTopReplacement) &#123; <span class="hljs-comment">// Single Top means we only want one instance on the back stack</span></span><br><span class="line">            <span class="hljs-keyword">if</span> (mBackStack.size &gt; <span class="hljs-number">1</span>) &#123; <span class="hljs-comment">// If the Fragment to be replaced is on the FragmentManager's</span></span><br><span class="line">                <span class="hljs-comment">// back stack, a simple replace() isn't enough so we</span></span><br><span class="line">                <span class="hljs-comment">// remove it from the back stack and put our replacement</span></span><br><span class="line">                <span class="hljs-comment">// on the back stack in its place</span></span><br><span class="line">                mFragmentManager!!.popBackStack(</span><br><span class="line">                    generateBackStackName(mBackStack.size, mBackStack.peekLast()),</span><br><span class="line">                    FragmentManager.POP_BACK_STACK_INCLUSIVE</span><br><span class="line">                )</span><br><span class="line">                ft.addToBackStack(generateBackStackName(mBackStack.size, destId))</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-literal">false</span></span><br><span class="line">        &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">            ft.addToBackStack(generateBackStackName(mBackStack.size + <span class="hljs-number">1</span>, destId))</span><br><span class="line">            <span class="hljs-literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">if</span> (navigatorExtras <span class="hljs-keyword">is</span> FragmentNavigator.Extras) &#123;</span><br><span class="line">            <span class="hljs-keyword">for</span> ((key, value) <span class="hljs-keyword">in</span> navigatorExtras.sharedElements) &#123;</span><br><span class="line">                ft.addSharedElement(key!!, value!!)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ft.setReorderingAllowed(<span class="hljs-literal">true</span>)</span><br><span class="line">        ft.commit()</span><br><span class="line">        (<span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> (isAdded) &#123;</span><br><span class="line">            mBackStack.add(destId)</span><br><span class="line">            destination</span><br><span class="line">        &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="line">            <span class="hljs-literal">null</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">createDestination</span><span class="hljs-params">()</span></span>: FragmentNavigator.Destination &#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> FragmentNavigator.Destination(<span class="hljs-keyword">this</span>)<span class="hljs-comment">//To change body of created functions use File | Settings | File Templates.</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">popBackStack</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Boolean</span> &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (mBackStack.isEmpty()) &#123;</span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">if</span> (mFragmentManager!!.isStateSaved) &#123;</span><br><span class="line">            Log.i(</span><br><span class="line">                TAG,</span><br><span class="line">                <span class="hljs-string">"Ignoring popBackStack() call: FragmentManager has already"</span></span><br><span class="line">                        + <span class="hljs-string">" saved its state"</span></span><br><span class="line">            )</span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        mFragmentManager?.popBackStack(</span><br><span class="line">            generateBackStackName(mBackStack.size, mBackStack.peekLast()),</span><br><span class="line">            FragmentManager.POP_BACK_STACK_INCLUSIVE</span><br><span class="line">        )</span><br><span class="line">        mBackStack.removeLast()</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSaveState</span><span class="hljs-params">()</span></span>: Bundle? &#123;</span><br><span class="line">        <span class="hljs-keyword">val</span> b = Bundle()</span><br><span class="line">        <span class="hljs-keyword">val</span> backStack = IntArray(mBackStack.size)</span><br><span class="line">        <span class="hljs-keyword">var</span> index = <span class="hljs-number">0</span></span><br><span class="line">        <span class="hljs-keyword">for</span> (id <span class="hljs-keyword">in</span> mBackStack) &#123;</span><br><span class="line">            backStack[index++] = id</span><br><span class="line">        &#125;</span><br><span class="line">        b.putIntArray(</span><br><span class="line">            KEY_BACK_STACK_IDS,</span><br><span class="line">            backStack</span><br><span class="line">        )</span><br><span class="line">        <span class="hljs-keyword">return</span> b</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onRestoreState</span><span class="hljs-params">(savedState: <span class="hljs-type">Bundle</span>)</span></span> &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (savedState != <span class="hljs-literal">null</span>) &#123;</span><br><span class="line">            <span class="hljs-keyword">val</span> backStack =</span><br><span class="line">                savedState.getIntArray(KEY_BACK_STACK_IDS)</span><br><span class="line">            <span class="hljs-keyword">if</span> (backStack != <span class="hljs-literal">null</span>) &#123;</span><br><span class="line">                mBackStack.clear()</span><br><span class="line">                <span class="hljs-keyword">for</span> (destId <span class="hljs-keyword">in</span> backStack) &#123;</span><br><span class="line">                    mBackStack.add(destId)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">generateBackStackName</span><span class="hljs-params">(backStackIndex: <span class="hljs-type">Int</span>, destId: <span class="hljs-type">Int</span>)</span></span>: String &#123;</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-string">"<span class="hljs-variable">$backStackIndex</span>-<span class="hljs-variable">$destId</span>"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>自定义FragmentNavigator是为了把其内部的navigate方法中的replace改成hide和show，虽然可以继承FragmentNavigator重写navigate方法，但是该方法中用到的mBackStack变量是私有的，需要反射拿到，所以把FragmentNavigator中的相关代码复制一份到自定义的CustomFragmentNavigator中，这样不需要继承也不需要反射了。</p>
<h4 id="自定义BottomNavigationView"><a href="#自定义BottomNavigationView" class="headerlink" title="自定义BottomNavigationView"></a>自定义BottomNavigationView</h4><p>首先定义一个json文件，里面保存底部导航栏的tab信息，放到app/src/assets 目录下面<br><figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;activeColor&quot;: &quot;#333333&quot;,</span><br><span class="line">  &quot;inActiveColor&quot;: &quot;#666666&quot;,</span><br><span class="line">  &quot;selectTab&quot;: 0,</span><br><span class="line">  &quot;tabs&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;size&quot;: 24,</span><br><span class="line">      &quot;enable&quot;: true,</span><br><span class="line">      &quot;index&quot;: 0,</span><br><span class="line">      &quot;pageUrl&quot;: &quot;main/tabs/HomeFragment&quot;,</span><br><span class="line">      &quot;title&quot;: &quot;首页&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;size&quot;: 24,</span><br><span class="line">      &quot;enable&quot;: true,</span><br><span class="line">      &quot;index&quot;: 1,</span><br><span class="line">      &quot;pageUrl&quot;: &quot;main/tabs/ApplyFragment&quot;,</span><br><span class="line">      &quot;title&quot;: &quot;应用&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;size&quot;: 24,</span><br><span class="line">      &quot;enable&quot;: true,</span><br><span class="line">      &quot;index&quot;: 2,</span><br><span class="line">      &quot;pageUrl&quot;: &quot;main/tabs/FindFragment&quot;,</span><br><span class="line">      &quot;title&quot;: &quot;发现&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;size&quot;: 24,</span><br><span class="line">      &quot;enable&quot;: true,</span><br><span class="line">      &quot;index&quot;: 3,</span><br><span class="line">      &quot;pageUrl&quot;: &quot;main/tabs/MineFragment&quot;,</span><br><span class="line">      &quot;title&quot;: &quot;我的&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>然后继承BottomNavigationView，解析上面的json，创建出menu对象，添加到BottomNavigationView中<br><figure class="highlight kotlin hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BottomBarView</span> : <span class="hljs-type">BottomNavigationView</span>, <span class="hljs-type">BottomNavigationView.OnNavigationItemSelectedListener &#123;</span></span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> navController: NavController? = <span class="hljs-literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> &#123;</span><br><span class="line">        <span class="hljs-keyword">val</span> sIcons = arrayOf(</span><br><span class="line">            R.drawable.icon_tab_home, R.drawable.icon_tab_apply,</span><br><span class="line">            R.drawable.icon_tab_find, R.drawable.icon_tab_mine</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">constructor</span>(context: Context) : <span class="hljs-keyword">this</span>(context, <span class="hljs-literal">null</span>)</span><br><span class="line">    <span class="hljs-keyword">constructor</span>(context: Context, attrs: AttributeSet?) : <span class="hljs-keyword">this</span>(context, attrs, <span class="hljs-number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="hljs-meta">@SuppressLint(<span class="hljs-meta-string">"RestrictedApi"</span>)</span></span><br><span class="line">    <span class="hljs-keyword">constructor</span>(context: Context, attrs: AttributeSet?, defStyleAttr: <span class="hljs-built_in">Int</span>) : <span class="hljs-keyword">super</span>(</span><br><span class="line">        context,</span><br><span class="line">        attrs,</span><br><span class="line">        defStyleAttr</span><br><span class="line">    ) &#123;</span><br><span class="line">        setOnNavigationItemSelectedListener(<span class="hljs-keyword">this</span>)</span><br><span class="line">        <span class="hljs-keyword">val</span> bottomBar = NavConfig.getBottomBar()</span><br><span class="line">        <span class="hljs-keyword">val</span> states = arrayOfNulls&lt;IntArray&gt;(<span class="hljs-number">2</span>)</span><br><span class="line">        states[<span class="hljs-number">0</span>] = intArrayOf(android.R.attr.state_selected)</span><br><span class="line">        states[<span class="hljs-number">1</span>] = intArrayOf()</span><br><span class="line">        <span class="hljs-keyword">val</span> colors = intArrayOf(</span><br><span class="line">            Color.parseColor(bottomBar.activeColor),</span><br><span class="line">            Color.parseColor(bottomBar.inActiveColor)</span><br><span class="line">        )</span><br><span class="line">        itemIconTintList = ColorStateList(states, colors)</span><br><span class="line">        itemTextColor = ColorStateList(states, colors)</span><br><span class="line">        <span class="hljs-comment">//设置文本和字体一直都显示</span></span><br><span class="line">        labelVisibilityMode = LabelVisibilityMode.LABEL_VISIBILITY_LABELED</span><br><span class="line">        <span class="hljs-keyword">val</span> tabs = bottomBar.tabs</span><br><span class="line">        <span class="hljs-comment">//添加menu</span></span><br><span class="line">        <span class="hljs-keyword">for</span> (tab <span class="hljs-keyword">in</span> tabs) &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (!tab.enable) &#123;</span><br><span class="line">                <span class="hljs-keyword">continue</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">val</span> itemId: <span class="hljs-built_in">Int</span> = getItemId(tab.pageUrl)</span><br><span class="line">            <span class="hljs-keyword">if</span> (itemId &lt; <span class="hljs-number">0</span>) &#123;</span><br><span class="line">                <span class="hljs-keyword">continue</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">val</span> menu = menu</span><br><span class="line">            <span class="hljs-keyword">val</span> menuItem = menu.add(<span class="hljs-number">0</span>, itemId, tab.index, tab.title)</span><br><span class="line">            menuItem.setIcon(sIcons[tab.index])</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-comment">//设置menu的大小 添加完所有的itemMenu之后才改变大小，因为每次添加都会先移除所有的item，排序之后再放入到容器中</span></span><br><span class="line">        <span class="hljs-keyword">var</span> index = <span class="hljs-number">0</span></span><br><span class="line">        <span class="hljs-keyword">for</span> (tab <span class="hljs-keyword">in</span> tabs) &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (!tab.enable) &#123;</span><br><span class="line">                <span class="hljs-keyword">continue</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">val</span> itemId: <span class="hljs-built_in">Int</span> = getItemId(tab.pageUrl)</span><br><span class="line">            <span class="hljs-keyword">if</span> (itemId &lt; <span class="hljs-number">0</span>) &#123;</span><br><span class="line">                <span class="hljs-keyword">continue</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">val</span> size = SizeUtils.dp2px(tab.size.toFloat())</span><br><span class="line">            <span class="hljs-keyword">val</span> menuView: BottomNavigationMenuView = getChildAt(<span class="hljs-number">0</span>) <span class="hljs-keyword">as</span> BottomNavigationMenuView</span><br><span class="line">            <span class="hljs-keyword">val</span> itemView: BottomNavigationItemView = menuView.getChildAt(index) <span class="hljs-keyword">as</span> BottomNavigationItemView</span><br><span class="line">            itemView.setIconSize(size)</span><br><span class="line">            <span class="hljs-keyword">if</span> (TextUtils.isEmpty(tab.title)) &#123; <span class="hljs-comment">//title为空的一般是中间的按钮 有那种中间变大的按钮</span></span><br><span class="line">                <span class="hljs-keyword">val</span> tintColor =</span><br><span class="line">                    <span class="hljs-keyword">if</span> (TextUtils.isEmpty(tab.tintColor)) Color.parseColor(<span class="hljs-string">"#ff678f"</span>) <span class="hljs-keyword">else</span> Color.parseColor(</span><br><span class="line">                        tab.tintColor</span><br><span class="line">                    )</span><br><span class="line">                itemView.setIconTintList(ColorStateList.valueOf(tintColor))</span><br><span class="line">                <span class="hljs-comment">//禁止上下浮动的效果</span></span><br><span class="line">                itemView.setShifting(<span class="hljs-literal">false</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            index++</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-comment">//底部导航栏默认选中项</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> != bottomBar.selectTab) &#123;</span><br><span class="line">            <span class="hljs-keyword">val</span> selectTab = tabs[bottomBar.selectTab]</span><br><span class="line">            <span class="hljs-keyword">if</span> (selectTab.enable) &#123;</span><br><span class="line">                <span class="hljs-keyword">val</span> itemId = getItemId(selectTab.pageUrl)</span><br><span class="line">                <span class="hljs-comment">//延迟一下在切换，等待NavGraphBuilder解析完成</span></span><br><span class="line">                post &#123; selectedItemId = itemId &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getItemId</span><span class="hljs-params">(pageUrl: <span class="hljs-type">String</span>)</span></span>: <span class="hljs-built_in">Int</span> &#123;</span><br><span class="line">        <span class="hljs-keyword">val</span> destination = NavConfig.getDestinationMap()[pageUrl]</span><br><span class="line">        <span class="hljs-keyword">return</span> destination?.id ?: -<span class="hljs-number">1</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">setNavController</span><span class="hljs-params">(navController: <span class="hljs-type">NavController</span>)</span></span> &#123;</span><br><span class="line">        <span class="hljs-keyword">this</span>.navController = navController</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onNavigationItemSelected</span><span class="hljs-params">(item: <span class="hljs-type">MenuItem</span>)</span></span>: <span class="hljs-built_in">Boolean</span> &#123;</span><br><span class="line">        navController?.navigate(item.itemId)</span><br><span class="line">        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>原生的BottomNavigationView，会自动解析我们定义在res/menu中的xml文件，创建出MenuItem对象然后add到Menu对象中。</p>
<p>我们将底部信息配置在json文件中，自己解析，自己创建menu，这样就灵活多了，而且可以根据后台规则动态改变底部导航栏的数量。</p>
<p>到这里一个比较好用的底部导航+Fragment就完成了。</p>
<h3 id="组件之间导航"><a href="#组件之间导航" class="headerlink" title="组件之间导航"></a>组件之间导航</h3><p>前面的底部导航+Fragment的例子，所有页面都在首页，并且通过底部BottomNavigationView点击完成切换页面，那如果我们在另一个activity中，点击跳转到新的activity，或者进行组件之间跳转该怎么办呢。</p>
<p>我知道在组建完成一个导航图之后，会将这个导航图设置给NavController，NavController是最终用来控制导航的控制器。通过NavController中的navigate方法传入需要导航的页面在导航图中的id就可以实现跳转了。</p>
<p>然而NavController是从MainActivity中初始化的<br><figure class="highlight kotlin hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">val</span> navController = Navigation.findNavController(<span class="hljs-keyword">this</span>, R.id.nav_host_fragment)</span><br><span class="line">NavGraphBuilder.build(navController,<span class="hljs-keyword">this</span>,R.id.nav_host_fragment)</span><br><span class="line">nav_view.setNavController(navController)</span><br></pre></td></tr></table></figure></p>
<p>我们在别的类中不容易拿到NavController对象</p>
<ul>
<li>一种方式可以在初始换完成之后，将navController对象保存在一个单列类的静态变量中，这样全局就都能拿到该对象进行导航跳转了，但是静态变量在内存中并不安全，当内存不足的时候也是容易被回收的，回收之后也就无法完成导航功能了</li>
<li>另一种方式可以通过反射，当navController对象为null的时候，反射MainActivity，然后拿到其内部NavHostFragment的实例，最终拿到navController对象。</li>
</ul>
<p>好像都不够优雅，后来有看了遍文档，文中说Navigation其实主要是为了那种单activity多fragment的应用设计的。如果你是多Activity的应用，建议每个Activity对应一个导航图和一个NavHostFragment。</p>
<p>对哦，一个应用中不一定只有一个NavController，我们可以专门创建一个组件之间activity跳转的导航图和NavController，用来管理不同activity之间跳转，说干就干<br><figure class="highlight kotlin hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NavManager</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span>&#123;</span><br><span class="line">        <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> sNavController:NavController? = <span class="hljs-literal">null</span></span><br><span class="line">        <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> sMavManager = NavManager()</span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">get</span><span class="hljs-params">()</span></span>:NavManager&#123;</span><br><span class="line">            setNavController()</span><br><span class="line">            <span class="hljs-keyword">return</span> sMavManager</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">setNavController</span><span class="hljs-params">()</span></span> &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span>(sNavController == <span class="hljs-literal">null</span>)&#123;</span><br><span class="line">                <span class="hljs-keyword">val</span> navController = NavController(Utils.getApp())</span><br><span class="line">                <span class="hljs-keyword">val</span> navigatorProvider = navController.navigatorProvider</span><br><span class="line">                <span class="hljs-keyword">val</span> navGraph = NavGraph(NavGraphNavigator(navigatorProvider))</span><br><span class="line">                <span class="hljs-keyword">val</span> activityNavigator = navigatorProvider.getNavigator(ActivityNavigator::<span class="hljs-class"><span class="hljs-keyword">class</span>.<span class="hljs-title">java</span>)</span></span><br><span class="line">                <span class="hljs-keyword">val</span> destinationMap = NavConfig.getDestinationMap()</span><br><span class="line">                <span class="hljs-keyword">val</span> activityDestinationStart:ActivityNavigator.Destination = getStartDestination(activityNavigator)</span><br><span class="line">                navGraph.addDestination(activityDestinationStart)</span><br><span class="line">                <span class="hljs-keyword">for</span> ((key, destination) <span class="hljs-keyword">in</span> destinationMap) &#123;</span><br><span class="line">                    <span class="hljs-keyword">if</span> (!destination.isFragment&amp;&amp;!destination.isBelongTab)&#123;</span><br><span class="line">                        <span class="hljs-keyword">val</span> activityDestination = activityNavigator.createDestination()</span><br><span class="line">                        activityDestination.id = destination.id</span><br><span class="line">                        activityDestination.setComponentName(</span><br><span class="line">                            ComponentName(Utils.getApp().packageName, destination.className!!)</span><br><span class="line">                        )</span><br><span class="line">                        activityDestination.addDeepLink(destination.pageUrl!!)</span><br><span class="line">                        navGraph.addDestination(activityDestination)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                navGraph.startDestination = activityDestinationStart.id</span><br><span class="line">                navController.graph = navGraph</span><br><span class="line">                sNavController = navController</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getStartDestination</span><span class="hljs-params">(activityNavigator:<span class="hljs-type">ActivityNavigator</span>)</span></span>: ActivityNavigator.Destination &#123;</span><br><span class="line">            <span class="hljs-keyword">val</span> activityDestination = activityNavigator.createDestination()</span><br><span class="line">            activityDestination.id = R.id.bottom_start_activity</span><br><span class="line">            activityDestination.setComponentName(</span><br><span class="line">                ComponentName(Utils.getApp().packageName, <span class="hljs-string">"com.chs.lib_core.navigation.EmptyActivity"</span>)</span><br><span class="line">            )</span><br><span class="line">            <span class="hljs-keyword">return</span> activityDestination</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">build</span><span class="hljs-params">(toWhere: <span class="hljs-type">String</span>)</span></span> : Builder&#123;</span><br><span class="line">        <span class="hljs-keyword">val</span> bundle = Bundle()</span><br><span class="line">        <span class="hljs-keyword">return</span> Builder(toWhere,bundle)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Builder</span></span>(<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> toWhere: String,<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> bundle: Bundle)&#123;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">withString</span><span class="hljs-params">(key:<span class="hljs-type">String</span>,value:<span class="hljs-type">String</span>)</span></span>:Builder&#123;</span><br><span class="line">            bundle.putString(key, value)</span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">withInt</span><span class="hljs-params">(key:<span class="hljs-type">String</span>,value:<span class="hljs-type">Int</span>)</span></span>:Builder&#123;</span><br><span class="line">            bundle.putInt(key, value)</span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">withLong</span><span class="hljs-params">(key:<span class="hljs-type">String</span>,value:<span class="hljs-type">Long</span>)</span></span>:Builder&#123;</span><br><span class="line">            bundle.putLong(key, value)</span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">withDouble</span><span class="hljs-params">(key:<span class="hljs-type">String</span>,value:<span class="hljs-type">Double</span>)</span></span>:Builder&#123;</span><br><span class="line">            bundle.putDouble(key, value)</span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">withBoolean</span><span class="hljs-params">(key:<span class="hljs-type">String</span>,value:<span class="hljs-type">Boolean</span>)</span></span>:Builder&#123;</span><br><span class="line">            bundle.putBoolean(key, value)</span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">withByte</span><span class="hljs-params">(key:<span class="hljs-type">String</span>,value:<span class="hljs-type">Byte</span>)</span></span>:Builder&#123;</span><br><span class="line">            bundle.putByte(key, value)</span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">withSerializable</span><span class="hljs-params">(key:<span class="hljs-type">String</span>,value: <span class="hljs-type">Serializable</span>)</span></span>:Builder&#123;</span><br><span class="line">            bundle.putSerializable(key, value)</span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">withParcelable</span><span class="hljs-params">(key:<span class="hljs-type">String</span>,value: <span class="hljs-type">Parcelable</span>)</span></span>:Builder&#123;</span><br><span class="line">            bundle.putParcelable(key, value)</span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getItemId</span><span class="hljs-params">(pageUrl: <span class="hljs-type">String</span>)</span></span>: <span class="hljs-built_in">Int</span> &#123;</span><br><span class="line">            <span class="hljs-keyword">val</span> destination = NavConfig.getDestinationMap()[pageUrl]</span><br><span class="line">            <span class="hljs-keyword">return</span> destination?.id ?: -<span class="hljs-number">1</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">navigate</span><span class="hljs-params">()</span></span>&#123;</span><br><span class="line">            sNavController?.navigate(getItemId(toWhere),bundle)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>直接new一个NavController，和一个新的NavGraph，解析生成的json文件。在注解中添加一个新的属性isBelongTab，是不是主页tab中的页面，不是放到当前导航图中。</p>
<p>每一个导航图要求必须要有一个startDestination（起始页），给NavController设置导航图的时候，会默认显示出起始页面。我们当前的导航图不需要起始页面，可能会随机跳转页面，我们也不知道谁是起始页。所以用一个透明的，空的activity来当起始页，启动之后直接关闭<br><figure class="highlight kotlin hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">EmptyActivity</span>:<span class="hljs-type">AppCompatActivity</span></span>() &#123;</span><br><span class="line">    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        finish()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>创建出NavController对象就好说了，条用其navigate方法传入要跳转的页面的id就可以完成跳转了。navigate方法有很多重载的方法，我们还可以传入bundle参数，传入切换动画等等。</p>
<p>最终如果我们想要完成一个不同组件之间的activity跳转如下</p>
<p>需要跳转的目标页面添加注解<br><figure class="highlight kotlin hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">@ActivityDestination(pageUrl = WanRouterKey.ACTIVITY_MAIN_MINE_RANK)</span></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RankActivity</span> : <span class="hljs-type">BaseActivity</span></span>() &#123;&#125;</span><br></pre></td></tr></table></figure></p>
<p>在点击事件中通过如下方式就可以愉快的进行跳转啦。<br><figure class="highlight kotlin hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">NavManager.<span class="hljs-keyword">get</span>()</span><br><span class="line">        .build(WanRouterKey.ACTIVITY_MAIN_MINE_RANK)</span><br><span class="line">        .withString(<span class="hljs-string">"stringparama"</span>,<span class="hljs-string">"stringparama"</span>)</span><br><span class="line">        .navigate()</span><br></pre></td></tr></table></figure></p>
<p>OK，自定义Navigation完成。</p>

        </div>
        
        <div class="level is-size-7 is-uppercase">
            <div class="level-start">
                <div class="level-item">
                    <span class="is-size-6 has-text-grey has-mr-7">#</span>
                    <a class="has-link-grey -link" href="/tags/jetpack/">jetpack</a>
                </div>
            </div>
        </div>
        
        
        
        <div class="social-share"></div>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css">
<script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script>
        
    </div>
</div>





<div class="card card-transparent">
    <div class="level post-navigation is-flex-wrap is-mobile">
        
        
        <div class="level-end">
            <a class="level level-item has-link-grey  article-nav-next" href="/2020/03/23/optimize/Android自动化测试入门-四-单元测试/">
                <span class="level-item">Android自动化测试入门(四)单元测试</span>
                <i class="level-item fas fa-chevron-right"></i>
            </a>
        </div>
        
    </div>
</div>



<div class="card">
    <div class="card-content">
        <h3 class="title is-5 has-text-weight-normal">Komentar</h3>
        
<script>
    var disqus_config = function () {
        this.page.url = 'https://chsmy.github.io/2020/04/19/technology/Jetpack之自定义Navigation/';
        this.page.identifier = '2020/04/19/technology/Jetpack之自定义Navigation/';
    };
    (function() {
        var d = document, s = d.createElement('script');  
        s.src = '//' + 'hexo-theme-icarus' + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>

<div id="disqus_thread">
    
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
    </div>
</div>
</div>
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered">
                <div>
                    
                        <img class="image is-128x128 has-mb-6" src="/images/avatar.png" alt="CHS">
                    
                    
                    <p class="is-size-4 is-block">
                        CHS
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        只要坚持，终会有收获
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>北京</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Artikel
                    </p>
                    <p class="title has-text-weight-normal">
                        71
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Kategori
                    </p>
                    <p class="title has-text-weight-normal">
                        16
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        Tag
                    </p>
                    <p class="title has-text-weight-normal">
                        11
                    </p>
                </div>
            </div>
        </nav>
        <div class="level">
            <a class="level-item button is-link is-rounded" href="https://github.com/chsmy">
                IKUTI</a>
        </div>
        
        
        <div class="level is-mobile">
            
            <a class="level-item button is-white is-marginless" target="_blank" title="Github" href="https://github.com/chsmy">
                
                <i class="fab fa-github"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" title="weibo" href="http://weibo.com/2504847694/profile?rightmod=1&amp;wvr=6&amp;mod=personinfo&amp;is_all=1">
                
                <i class="fab fa-weibo"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" title="csdn" href="https://blog.csdn.net/mingyunxiaohai">
                
                <i class="fab fa-wordpress"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" title="简书" href="https://www.jianshu.com/u/6ab3e65ba7b5">
                
                <i class="fab fa-dribbble"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" title="RSS" href="/">
                
                <i class="fas fa-rss"></i>
                
            </a>
            
        </div>
        
    </div>
</div>
    
        
    
        

<div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Tautan
        </h3>
        <ul class="menu-list">
        
            <li>
                <a class="level is-mobile" href="https://hexo.io" target="_blank">
                    <span class="level-left">
                        <span class="level-item">Hexo</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">hexo.io</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level is-mobile" href="http://www.wanandroid.com/" target="_blank">
                    <span class="level-left">
                        <span class="level-item">玩Android</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">www.wanandroid.com</span>
                    </span>
                </a>
            </li>
        
        </ul>
        </div>
    </div>
</div>


    
        
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Kategori
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/Android/">
            <span class="level-start">
                <span class="level-item">Android</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">60</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/Android/UI/">
            <span class="level-start">
                <span class="level-item">UI</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">11</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Android/c-c/">
            <span class="level-start">
                <span class="level-item">c/c++</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">9</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Android/jetpack/">
            <span class="level-start">
                <span class="level-item">jetpack</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">8</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Android/kotlin/">
            <span class="level-start">
                <span class="level-item">kotlin</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Android/架构/">
            <span class="level-start">
                <span class="level-item">架构</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">16</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Android/测试和性能优化/">
            <span class="level-start">
                <span class="level-item">测试和性能优化</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">5</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Android/源码/">
            <span class="level-start">
                <span class="level-item">源码</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">9</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/Android/资料/">
            <span class="level-start">
                <span class="level-item">资料</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/Java/">
            <span class="level-start">
                <span class="level-item">Java</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/Java/设计模式/">
            <span class="level-start">
                <span class="level-item">设计模式</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/人生/">
            <span class="level-start">
                <span class="level-item">人生</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">7</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/人生/感悟/">
            <span class="level-start">
                <span class="level-item">感悟</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">4</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/人生/读书/">
            <span class="level-start">
                <span class="level-item">读书</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">3</span>
            </span>
        </a></li></ul></li><li>
        <a class="level is-marginless" href="/categories/跨平台/">
            <span class="level-start">
                <span class="level-item">跨平台</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a><ul><li>
        <a class="level is-marginless" href="/categories/跨平台/flutter/">
            <span class="level-start">
                <span class="level-item">flutter</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">2</span>
            </span>
        </a></li></ul></li>
            </ul>
        </div>
    </div>
</div>
    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Awan tag
        </h3>
        <a href="/tags/Flutter/" style="font-size: 11.11px;">Flutter</a> <a href="/tags/UI/" style="font-size: 18.89px;">UI</a> <a href="/tags/c-c/" style="font-size: 16.67px;">c/c++</a> <a href="/tags/jetpack/" style="font-size: 15.56px;">jetpack</a> <a href="/tags/感悟/" style="font-size: 13.33px;">感悟</a> <a href="/tags/架构/" style="font-size: 20px;">架构</a> <a href="/tags/测试和性能优化/" style="font-size: 14.44px;">测试和性能优化</a> <a href="/tags/设计模式/" style="font-size: 11.11px;">设计模式</a> <a href="/tags/读书/" style="font-size: 12.22px;">读书</a> <a href="/tags/资料/" style="font-size: 10px;">资料</a> <a href="/tags/进阶/" style="font-size: 17.78px;">进阶</a>
    </div>
</div>

    
    
        <div class="column-right-shadow is-hidden-widescreen ">
        
            
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Terbaru
        </h3>
        
        <article class="media">
            
            <a href="/2020/04/19/technology/Jetpack之自定义Navigation/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Jetpack之自定义Navigation">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-04-19T07:43:37.000Z">2020-04-19</time></div>
                    <a href="/2020/04/19/technology/Jetpack之自定义Navigation/" class="has-link-black-ter is-size-6">Jetpack之自定义Navigation</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Android/">Android</a> / <a class="has-link-grey -link" href="/categories/Android/jetpack/">jetpack</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/03/23/optimize/Android自动化测试入门-四-单元测试/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Android自动化测试入门(四)单元测试">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-03-23T03:26:50.000Z">2020-03-23</time></div>
                    <a href="/2020/03/23/optimize/Android自动化测试入门-四-单元测试/" class="has-link-black-ter is-size-6">Android自动化测试入门(四)单元测试</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Android/">Android</a> / <a class="has-link-grey -link" href="/categories/Android/测试和性能优化/">测试和性能优化</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/03/09/optimize/Android自动化测试入门-三-Espresso/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Android自动化测试入门(三)Espresso">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-03-09T14:55:13.000Z">2020-03-09</time></div>
                    <a href="/2020/03/09/optimize/Android自动化测试入门-三-Espresso/" class="has-link-black-ter is-size-6">Android自动化测试入门(三)Espresso</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Android/">Android</a> / <a class="has-link-grey -link" href="/categories/Android/测试和性能优化/">测试和性能优化</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/03/09/optimize/Android自动化测试入门-二-UI-Automator/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Android自动化测试入门(二)UI Automator">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-03-09T14:54:55.000Z">2020-03-09</time></div>
                    <a href="/2020/03/09/optimize/Android自动化测试入门-二-UI-Automator/" class="has-link-black-ter is-size-6">Android自动化测试入门(二)UI Automator</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Android/">Android</a> / <a class="has-link-grey -link" href="/categories/Android/测试和性能优化/">测试和性能优化</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/03/09/optimize/Android自动化测试入门-一-Monkey和MonkeyRunner/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Android自动化测试入门(一)Monkey和MonkeyRunner">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-03-09T14:54:38.000Z">2020-03-09</time></div>
                    <a href="/2020/03/09/optimize/Android自动化测试入门-一-Monkey和MonkeyRunner/" class="has-link-black-ter is-size-6">Android自动化测试入门(一)Monkey和MonkeyRunner</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Android/">Android</a> / <a class="has-link-grey -link" href="/categories/Android/测试和性能优化/">测试和性能优化</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>

        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Arsip
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2020/04/">
                <span class="level-start">
                    <span class="level-item">April 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/03/">
                <span class="level-start">
                    <span class="level-item">March 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/02/">
                <span class="level-start">
                    <span class="level-item">February 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/01/">
                <span class="level-start">
                    <span class="level-item">January 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/12/">
                <span class="level-start">
                    <span class="level-item">December 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/11/">
                <span class="level-start">
                    <span class="level-item">November 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/10/">
                <span class="level-start">
                    <span class="level-item">October 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/09/">
                <span class="level-start">
                    <span class="level-item">September 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/08/">
                <span class="level-start">
                    <span class="level-item">August 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/07/">
                <span class="level-start">
                    <span class="level-item">July 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/06/">
                <span class="level-start">
                    <span class="level-item">June 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/05/">
                <span class="level-start">
                    <span class="level-item">May 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/04/">
                <span class="level-start">
                    <span class="level-item">April 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">14</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/03/">
                <span class="level-start">
                    <span class="level-item">March 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">11</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/02/">
                <span class="level-start">
                    <span class="level-item">February 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Tag
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Flutter/">
                        <span class="tag">Flutter</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/UI/">
                        <span class="tag">UI</span>
                        <span class="tag is-grey">11</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/c-c/">
                        <span class="tag">c/c++</span>
                        <span class="tag is-grey">9</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/jetpack/">
                        <span class="tag">jetpack</span>
                        <span class="tag is-grey">8</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/感悟/">
                        <span class="tag">感悟</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/架构/">
                        <span class="tag">架构</span>
                        <span class="tag is-grey">16</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/测试和性能优化/">
                        <span class="tag">测试和性能优化</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/设计模式/">
                        <span class="tag">设计模式</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/读书/">
                        <span class="tag">读书</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/资料/">
                        <span class="tag">资料</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/进阶/">
                        <span class="tag">进阶</span>
                        <span class="tag is-grey">10</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
        
        </div>
    
</div>

                




<div class="column is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only has-order-3 column-right ">
    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            Terbaru
        </h3>
        
        <article class="media">
            
            <a href="/2020/04/19/technology/Jetpack之自定义Navigation/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Jetpack之自定义Navigation">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-04-19T07:43:37.000Z">2020-04-19</time></div>
                    <a href="/2020/04/19/technology/Jetpack之自定义Navigation/" class="has-link-black-ter is-size-6">Jetpack之自定义Navigation</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Android/">Android</a> / <a class="has-link-grey -link" href="/categories/Android/jetpack/">jetpack</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/03/23/optimize/Android自动化测试入门-四-单元测试/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Android自动化测试入门(四)单元测试">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-03-23T03:26:50.000Z">2020-03-23</time></div>
                    <a href="/2020/03/23/optimize/Android自动化测试入门-四-单元测试/" class="has-link-black-ter is-size-6">Android自动化测试入门(四)单元测试</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Android/">Android</a> / <a class="has-link-grey -link" href="/categories/Android/测试和性能优化/">测试和性能优化</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/03/09/optimize/Android自动化测试入门-三-Espresso/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Android自动化测试入门(三)Espresso">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-03-09T14:55:13.000Z">2020-03-09</time></div>
                    <a href="/2020/03/09/optimize/Android自动化测试入门-三-Espresso/" class="has-link-black-ter is-size-6">Android自动化测试入门(三)Espresso</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Android/">Android</a> / <a class="has-link-grey -link" href="/categories/Android/测试和性能优化/">测试和性能优化</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/03/09/optimize/Android自动化测试入门-二-UI-Automator/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Android自动化测试入门(二)UI Automator">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-03-09T14:54:55.000Z">2020-03-09</time></div>
                    <a href="/2020/03/09/optimize/Android自动化测试入门-二-UI-Automator/" class="has-link-black-ter is-size-6">Android自动化测试入门(二)UI Automator</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Android/">Android</a> / <a class="has-link-grey -link" href="/categories/Android/测试和性能优化/">测试和性能优化</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/03/09/optimize/Android自动化测试入门-一-Monkey和MonkeyRunner/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="Android自动化测试入门(一)Monkey和MonkeyRunner">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-03-09T14:54:38.000Z">2020-03-09</time></div>
                    <a href="/2020/03/09/optimize/Android自动化测试入门-一-Monkey和MonkeyRunner/" class="has-link-black-ter is-size-6">Android自动化测试入门(一)Monkey和MonkeyRunner</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Android/">Android</a> / <a class="has-link-grey -link" href="/categories/Android/测试和性能优化/">测试和性能优化</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>

    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            Arsip
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2020/04/">
                <span class="level-start">
                    <span class="level-item">April 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/03/">
                <span class="level-start">
                    <span class="level-item">March 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/02/">
                <span class="level-start">
                    <span class="level-item">February 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/01/">
                <span class="level-start">
                    <span class="level-item">January 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/12/">
                <span class="level-start">
                    <span class="level-item">December 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/11/">
                <span class="level-start">
                    <span class="level-item">November 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/10/">
                <span class="level-start">
                    <span class="level-item">October 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/09/">
                <span class="level-start">
                    <span class="level-item">September 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/08/">
                <span class="level-start">
                    <span class="level-item">August 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/07/">
                <span class="level-start">
                    <span class="level-item">July 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/06/">
                <span class="level-start">
                    <span class="level-item">June 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/05/">
                <span class="level-start">
                    <span class="level-item">May 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">6</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/04/">
                <span class="level-start">
                    <span class="level-item">April 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">14</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/03/">
                <span class="level-start">
                    <span class="level-item">March 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">11</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/02/">
                <span class="level-start">
                    <span class="level-item">February 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Tag
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Flutter/">
                        <span class="tag">Flutter</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/UI/">
                        <span class="tag">UI</span>
                        <span class="tag is-grey">11</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/c-c/">
                        <span class="tag">c/c++</span>
                        <span class="tag is-grey">9</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/jetpack/">
                        <span class="tag">jetpack</span>
                        <span class="tag is-grey">8</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/感悟/">
                        <span class="tag">感悟</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/架构/">
                        <span class="tag">架构</span>
                        <span class="tag is-grey">16</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/测试和性能优化/">
                        <span class="tag">测试和性能优化</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/设计模式/">
                        <span class="tag">设计模式</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/读书/">
                        <span class="tag">读书</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/资料/">
                        <span class="tag">资料</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/进阶/">
                        <span class="tag">进阶</span>
                        <span class="tag is-grey">10</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
    
    
</div>

            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/logo.png" alt="Jetpack之自定义Navigation" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2020 John Doe&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a href="http://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a>
                
                </p>
            </div>
            <div class="level-end">
            
                <div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle">
                
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Creative Commons" href="https://github.com/chsmy">
                        
                        <i class="fab fa-creative-commons"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Attribution 4.0 International" href="https://github.com/chsmy">
                        
                        <i class="fab fa-creative-commons-by"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Download on GitHub" href="https://github.com/chsmy">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                </p>
                
                </div>
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("CHS");</script>


    
    
    
    <script src="/js/animation.js"></script>
    

    
    
    
    <script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
    <script src="/js/gallery.js" defer></script>
    

    
    

<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


    
    
<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>

    
    

<a id="back-to-top" title="Kembali ke atas" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>


    
    

    
    
    
    

    
    
    
    
    
    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>
    <script src="/js/clipboard.js" defer></script>
    

    
    
    


<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Tulis Sesuatu..">
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Artikel',
                PAGES: 'Halaman',
                CATEGORIES: 'Kategori',
                TAGS: 'Tag',
                UNTITLED: 'Tanpa Judul',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
</body>
</html>